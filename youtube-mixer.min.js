function newRemix(){return{id:(new Date).getTime().toString(),title:"",videos:[]}}function onYouTubeIframeAPIReady(){YouTubeMixer.onYouTubeIframeAPIReady()}var defaultVideo={title:"",url:"",thumbnailUrl:"",startTimeInMs:0,endTimeInMs:0,comments:[]},YouTubeMixer;(function(n){function ht(){var t=document.createElement("script"),n;t.src="https://www.youtube.com/iframe_api",n=document.getElementsByTagName("script")[0],n.parentNode.insertBefore(t,n),$(function(){ti(),ct()})}function ct(){k=$(".search__input").keydown(function(n){n.which===13&&gt()}),f=$(".search__results").hide().on("click",".search__results__item",kt);$(document).click(function(n){$(n.target).closest(".search__results").length||f.hide()}).on("click",".seek-to",lt);d=$(".queue").on("click",".queue__item",dt),g=$(".player__comments").on("mouseenter click",".player__comments__comment",at),it=$(".player__controls").on("change","input",function(n){var i=$(n.currentTarget),r=$(".player__controls input").index(i);r==0?t.startTimeInMs=i.val():t.endTimeInMs=i.val()});$(".time-input").on("change",function(n){var t=$(n.currentTarget);t.prev(".seek-to").data("time",t.val())});u=$(".remix__list"),rt=$(".remix__title").on("change",function(n){i.title=$(n.currentTarget).val()});$(".remix__save").on("click",function(){localStorage["remix-"+i.id]=JSON.stringify(i),h()});$(".remix__load").on("click",function(){var n=u.val();n&&s(JSON.parse(localStorage[n]))});$(".remix__delete").on("click",function(){var n=u.val();n&&(localStorage.removeItem(n),h())});$(".remix__new").on("click",function(){s(newRemix())});h(),nt=$(".comments__list").on("change","input",function(n){var i=$(n.currentTarget),r=$(".comments__list input").index(i),u=t.comments[Math.floor(r/2)];r&1?u.endTimeInMs=i.val():u.startTimeInMs=i.val(),w(e())}).on("change keyup","textarea",function(n){var i=$(n.currentTarget),r=$(".comments__list textarea").index(i),u=t.comments[r];u.text=i.val(),ft()}).on("click",".comments__list__item__delete",function(n){var i=$(n.currentTarget),r=$(".comments__list .comments__list__item__delete").index(i);t.comments.splice(r,1),i.closest("tr").fadeOut(function(){et()})}),o=$(".comments__input").keydown(function(n){n.which===13&&st(n)}),$(".comments__add").click(st)}function lt(n){var t=Number($(n.currentTarget).data("time"));r.seekTo(t/1e3,!0)}function at(n){var i=$(n.currentTarget);i.is(":data(draggable)")||i.resizable({stop:function(n,i){var r=t.comments[i.element.index()];r.width=i.size.width,r.height=i.size.height}}).draggable({containment:".player__comments",stop:function(n,i){var r=t.comments[i.helper.index()];r.top=i.position.top,r.left=i.position.left}})}function vt(){r=new YT.Player("player__iframe",{height:390,width:640,origin:location.href,events:{onReady:yt,onStateChange:pt},playerVars:{wmode:"opaque"}})}function s(n){i=n,t=i.videos[0]||defaultVideo,wt()}function yt(){setInterval(bt,200),t&&ot(t)}function pt(){}function wt(){rt.val(i.title),ut(),a()}function h(){var n,t;u.empty();for(n in localStorage)n.indexOf("remix-")===0&&(t=JSON.parse(localStorage[n]),u.append('<option value="'+n+'">'+t.title+" ("+n+")<\/option>"))}function e(){return!r||!r.getCurrentTime?0:Math.floor(r.getCurrentTime()*1e3)}function ut(){c=c||Handlebars.compile($("#queue-item-template").html()),d.html(i.videos.map(function(n){return c(n)}).join(""))}function a(){l=l||Handlebars.compile($("#current-video-template").html()),it.html(l(t)),et()}function ft(){v=v||Handlebars.compile($("#player-comment-template").html()),g.html(t.comments.map(function(n){return v(n)}).join("")),tt=$(".player__comments__comment"),w(e())}function et(){y=y||Handlebars.compile($("#comment-list-item-template").html()),nt.html(t.comments.map(function(n){return y(n)}).join("")),ft()}function bt(){if(r&&t){var n=e();n!==p&&(n>=t.endTimeInMs&&r.pauseVideo(),w(n),p=n)}}function w(n){t.comments.forEach(function(t,i){var r=n>=t.startTimeInMs&&n<=t.endTimeInMs,u=tt.eq(i).toggle(r)})}function kt(n){var t=$(n.currentTarget).data("video");if(!t)throw new Error("Video does not exist.");i.videos.push(t),ut()}function dt(n){var t=i.videos[$(n.currentTarget).closest(".queue__item").index()];ot(t)}function ot(n){if(!n)throw new Error("Video does not exist.");r.cueVideoByUrl(n.url,n.startTimeInMs/1e3),n!==t&&(t=n,a())}function st(n){var r=o.val(),i;o.val(""),i=Math.floor(e()/1e3)*1e3,t.comments.push({text:r,startTimeInMs:i,endTimeInMs:i+3e3,top:0,left:0,width:100,height:20}),t.comments.sort(function(n,t){return n.startTimeInMs-t.startTimeInMs}),a(),n.preventDefault()}function gt(){var n=encodeURIComponent(k.val());$.getJSON("https://gdata.youtube.com/feeds/api/videos?q="+n+"&alt=json-in-script&v=2&callback=?",{},function(n){var t=n.feed.entry.map(function(n){console.log(n);return{title:n.title.$t,url:n.content.src,thumbnailUrl:n.media$group.media$thumbnail.filter(function(n){return n.yt$name==="default"})[0].url,comments:[],startTimeInMs:0,endTimeInMs:n.media$group.yt$duration.seconds*1e3}});ni(t)})}function ni(n){f.show(),n.forEach(function(n){$('<li class="search__results__item"><img class="search__results__item__thumbnail" src="'+n.thumbnailUrl+'" /><span class="search__results__item__title">'+n.title+"<\/span><\/li>").data("video",n).appendTo(f)})}function ti(){Handlebars.registerHelper("time_input",function(n){return b=b||Handlebars.compile($("#time-input-template").html()),new Handlebars.SafeString(b({timeInMs:n}))})}var k,f,d,g,nt,o,tt,it,rt,u,i=newRemix(),t=defaultVideo,r,c,l,v,y,p,b;n.init=ht,n.onYouTubeIframeAPIReady=vt,n.load=s,p=null})(YouTubeMixer||(YouTubeMixer={}))