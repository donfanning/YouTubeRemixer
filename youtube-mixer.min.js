function newRemix(){return{id:(new Date).getTime().toString(),title:"",videos:[]}}function onYouTubeIframeAPIReady(){YouTubeMixer.onYouTubeIframeAPIReady()}var defaultVideo={title:"",url:"",thumbnailUrl:"",startTimeInMs:0,endTimeInMs:0,comments:[]},YouTubeMixer;(function(n){function ct(){var t=document.createElement("script"),n;t.src="https://www.youtube.com/iframe_api",n=document.getElementsByTagName("script")[0],n.parentNode.insertBefore(t,n),$(function(){ii(),lt()})}function lt(){nt=$(".search__input").keydown(function(n){n.which===13&&ht()}),$(".search__button").click(ht),e=$(".search__results").hide().on("click",".search__results__item",gt);$(document).click(function(n){$(n.target).closest(".search__results").length||e.hide()}).on("click",".player__split",at);tt=$(".queue").on("click",".queue__item",ni),it=$(".player__comments").on("mouseenter click",".player__comments__comment",yt),ft=$(".player__controls").on("change","input",function(n){var i=$(n.currentTarget),r=$(".player__controls input").index(i);r==0?t.startTimeInMs=i.val():t.endTimeInMs=i.val()});$(document).on("click",".seek-to",vt).on("change",".time-input",function(n){var t=$(n.currentTarget);t.prev(".seek-to").data("time",t.val())}).on("click",".take-now",function(n){var t=$(n.currentTarget);t.prev(".time-input").val(u()).trigger("change")});f=$(".remix__list"),et=$(".remix__title").on("change",function(n){i.title=$(n.currentTarget).val()});$(".remix__save").on("click",function(){localStorage["remix-"+i.id]=JSON.stringify(i),l()});$(".remix__load").on("click",function(){var n=f.val();n&&c(JSON.parse(localStorage[n]))});$(".remix__delete").on("click",function(){var n=f.val();n&&(localStorage.removeItem(n),l())});$(".remix__new").on("click",function(){c(newRemix())});l(),rt=$(".comments__list").on("change","input",function(n){var i=$(n.currentTarget),r=$(".comments__list input").index(i),f=t.comments[Math.floor(r/2)];r&1?f.endTimeInMs=i.val():f.startTimeInMs=i.val(),d(u())}).on("change keyup","textarea",function(n){var i=$(n.currentTarget),r=$(".comments__list textarea").index(i),u=t.comments[r];u.text=i.val(),ot()}).on("click",".comments__list__item__delete",function(n){var i=$(n.currentTarget),r=$(".comments__list .comments__list__item__delete").index(i);t.comments.splice(r,1),i.closest("tr").fadeOut(function(){o()})}),h=$(".comments__input").keydown(function(n){n.which===13&&st(n)}),$(".comments__add").click(st)}function at(){if(t){var f=i.videos.indexOf(t),n=_.extend({},t),r=u();t.endTimeInMs=r,n.startTimeInMs=r,n.comments=[],i.videos.splice(f+1,0,n),p(),v()}}function vt(n){var t=Number($(n.currentTarget).data("time"));r.seekTo(t/1e3,!0)}function yt(n){var i=$(n.currentTarget);i.is(":data(draggable)")||i.resizable({stop:function(n,i){var r=t.comments[i.element.index()];r.width=i.size.width,r.height=i.size.height}}).draggable({containment:".player__comments",stop:function(n,i){var r=t.comments[i.helper.index()];r.top=i.position.top,r.left=i.position.left}})}function pt(){r=new YT.Player("player__iframe",{height:390,width:640,origin:location.href,events:{onReady:wt,onStateChange:bt},playerVars:{wmode:"opaque"}})}function c(n){i=n,s(i.videos[0]||defaultVideo),kt()}function wt(){setInterval(dt,200),t&&s(t)}function bt(){}function kt(){et.val(i.title),v(),p(),o()}function l(){var n,t;f.empty();for(n in localStorage)n.indexOf("remix-")===0&&(t=JSON.parse(localStorage[n]),f.append('<option value="'+n+'">'+t.title+" ("+n+")<\/option>"))}function u(){return!r||!r.getCurrentTime?0:Math.floor(r.getCurrentTime()*1e3)}function v(){a=a||Handlebars.compile($("#queue-item-template").html()),tt.html(i.videos.map(function(n){return a(n)}).join(""))}function p(){y=y||Handlebars.compile($("#current-video-template").html()),ft.html(y(t))}function ot(){w=w||Handlebars.compile($("#player-comment-template").html()),it.html(t.comments.map(function(n){return w(n)}).join("")),ut=$(".player__comments__comment"),d(u())}function o(){b=b||Handlebars.compile($("#comment-list-item-template").html()),rt.html(t.comments.map(function(n){return b(n)}).join("")),ot()}function dt(){var n,f;r&&t&&(n=u(),n!==k&&(n>=t.endTimeInMs&&(r.pauseVideo(),$(".queue__autoplay").is(":checked")&&(f=i.videos.indexOf(t),f>=0&&f<i.videos.length-1&&s(i.videos[f+1]))),d(n),k=n))}function d(n){t.comments.forEach(function(t,i){var r=n>=t.startTimeInMs&&n<=t.endTimeInMs,u=ut.eq(i).toggle(r)})}function gt(n){var t=$(n.currentTarget).data("video");if(!t)throw new Error("Video does not exist.");i.videos.push(t),v()}function ni(n){var t=i.videos[$(n.currentTarget).closest(".queue__item").index()];s(t)}function s(n){if(!n)throw new Error("Video does not exist.");r.cueVideoByUrl(n.url,n.startTimeInMs/1e3),n!==t&&(t=n,p(),o())}function st(n){var r=h.val(),i;h.val(""),i=Math.floor(u()/1e3)*1e3,t.comments.push({text:r,startTimeInMs:i,endTimeInMs:i+3e3,top:0,left:0,width:100,height:20}),t.comments.sort(function(n,t){return n.startTimeInMs-t.startTimeInMs}),o(),n.preventDefault()}function ht(){var n=encodeURIComponent(nt.val());$.getJSON("https://gdata.youtube.com/feeds/api/videos?q="+n+"&alt=json-in-script&v=2&callback=?",{},function(n){var t=n.feed.entry.map(function(n){console.log(n);return{title:n.title.$t,url:n.content.src,thumbnailUrl:n.media$group.media$thumbnail.filter(function(n){return n.yt$name==="default"})[0].url,comments:[],startTimeInMs:0,endTimeInMs:n.media$group.yt$duration.seconds*1e3}});ti(t)})}function ti(n){e.show(),n.forEach(function(n){$('<li class="search__results__item"><img class="search__results__item__thumbnail" src="'+n.thumbnailUrl+'" /><span class="search__results__item__title">'+n.title+"<\/span><\/li>").data("video",n).appendTo(e)})}function ii(){Handlebars.registerHelper("time_input",function(n){return g=g||Handlebars.compile($("#time-input-template").html()),new Handlebars.SafeString(g({timeInMs:n}))})}var nt,e,tt,it,rt,h,ut,ft,et,f,i=newRemix(),t=defaultVideo,r,a,y,w,b,k,g;n.init=ct,n.onYouTubeIframeAPIReady=pt,n.load=c,k=null})(YouTubeMixer||(YouTubeMixer={}))