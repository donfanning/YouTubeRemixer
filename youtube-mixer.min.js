function onYouTubeIframeAPIReady(){YouTubeMixer.onYouTubeIframeAPIReady()}var defaultVideo={title:"",url:"",thumbnailUrl:"",startTimeInMs:0,endTimeInMs:0,comments:[]},YouTubeMixer;(function(n){function et(){var t=document.createElement("script"),n;t.src="https://www.youtube.com/iframe_api",n=document.getElementsByTagName("script")[0],n.parentNode.insertBefore(t,n),$(function(){dt(),ot(),nt({title:"Foo Fighters Remix",videos:[{title:"Foo Fighters. Walk.",startTimeInMs:1e3,endTimeInMs:6e4,url:"https://www.youtube.com/v/4PkcfQtibmU?version=3&f=videos&app=youtube_gdata",thumbnailUrl:"http://i.ytimg.com/vi/4PkcfQtibmU/default.jpg",comments:[{text:"wtf?",startTimeInMs:1e3,endTimeInMs:2e3,top:200,left:137,width:79,height:37},{text:"yay!",startTimeInMs:4e3,endTimeInMs:9e3,top:110,left:415,width:null,height:null},{text:"so cool guys except what about this super long comment that just goes on and on?!",startTimeInMs:6e3,endTimeInMs:7e3,top:297,left:520,width:null,height:null},{text:"get funky!",startTimeInMs:17e3,endTimeInMs:19e3,top:105,left:254,width:138,height:127}]}]})})}function ot(){p=$(".search__input").keydown(function(n){n.which===13&&bt()}),u=$(".search__results").hide().on("click",".search__results__item",pt);$(document).click(function(n){$(n.target).closest(".search__results").length||u.hide()}).on("click",".seek-to",st);w=$(".queue").on("click",".queue__item",wt),b=$(".player__comments").on("mouseenter click",".player__comments__comment",ht),g=$(".player__controls").on("change","input",function(n){var i=$(n.currentTarget),r=$(".player__controls input").index(i);r==0?t.startTimeInMs=i.val():t.endTimeInMs=i.val()});$(".time-input").on("change",function(n){var t=$(n.currentTarget);t.prev(".seek-to").data("time",t.val())});$(".remix__title").on("change",function(n){r.title=$(n.currentTarget).val()});k=$(".comments__list").on("change","input",function(n){var i=$(n.currentTarget),r=$(".comments__list input").index(i),u=t.comments[Math.floor(r/2)];r&1?u.endTimeInMs=i.val():u.startTimeInMs=i.val(),v(f())}).on("change keyup","textarea",function(n){var i=$(n.currentTarget),r=$(".comments__list textarea").index(i),u=t.comments[r];u.text=i.val(),it()}).on("click",".comments__list__item__delete",function(n){var i=$(n.currentTarget),r=$(".comments__list .comments__list__item__delete").index(i);t.comments.splice(r,1),i.closest("tr").fadeOut(function(){rt()})}),e=$(".comments__input").keydown(function(n){n.which===13&&ft(n)}),$(".comments__add").click(ft)}function st(n){var t=Number($(n.currentTarget).data("time"));i.seekTo(t/1e3,!0)}function ht(n){var i=$(n.currentTarget);i.is(":data(draggable)")||i.resizable({stop:function(n,i){var r=t.comments[i.element.index()];r.width=i.size.width,r.height=i.size.height}}).draggable({containment:".player__comments",stop:function(n,i){var r=t.comments[i.helper.index()];r.top=i.position.top,r.left=i.position.left}})}function ct(){i=new YT.Player("player__iframe",{height:390,width:640,origin:location.href,events:{onReady:lt,onStateChange:at},playerVars:{wmode:"opaque"}})}function nt(n){r=n,t=r.videos[0]||defaultVideo,vt()}function lt(){setInterval(yt,200),t&&ut(t)}function at(){}function vt(){$(".remix__title").val(r.title),tt(),h()}function f(){return!i||!i.getCurrentTime?0:Math.floor(i.getCurrentTime()*1e3)}function tt(){o=o||Handlebars.compile($("#queue-item-template").html()),w.html(r.videos.map(function(n){return o(n)}).join(""))}function h(){s=s||Handlebars.compile($("#current-video-template").html()),g.html(s(t)),rt()}function it(){c=c||Handlebars.compile($("#player-comment-template").html()),b.html(t.comments.map(function(n){return c(n)}).join("")),d=$(".player__comments__comment"),v(f())}function rt(){l=l||Handlebars.compile($("#comment-list-item-template").html()),k.html(t.comments.map(function(n){return l(n)}).join("")),it()}function yt(){if(i&&t){var n=f();n!==a&&(n>=t.endTimeInMs&&i.pauseVideo(),v(n),a=n)}}function v(n){t.comments.forEach(function(t,i){var r=n>=t.startTimeInMs&&n<=t.endTimeInMs,u=d.eq(i).toggle(r)})}function pt(n){var t=$(n.currentTarget).data("video");if(!t)throw new Error("Video does not exist.");r.videos.push(t),tt()}function wt(n){var t=r.videos[$(n.currentTarget).closest(".queue__item").index()];ut(t)}function ut(n){if(!n)throw new Error("Video does not exist.");i.cueVideoByUrl(n.url,n.startTimeInMs/1e3),n!==t&&(t=n,h())}function ft(n){var r=e.val(),i;e.val(""),i=Math.floor(f()/1e3)*1e3,t.comments.push({text:r,startTimeInMs:i,endTimeInMs:i+3e3,top:0,left:0,width:100,height:20}),t.comments.sort(function(n,t){return n.startTimeInMs-t.startTimeInMs}),h(),n.preventDefault()}function bt(){var n=encodeURIComponent(p.val());$.getJSON("https://gdata.youtube.com/feeds/api/videos?q="+n+"&alt=json-in-script&v=2&callback=?",{},function(n){var t=n.feed.entry.map(function(n){console.log(n);return{title:n.title.$t,url:n.content.src,thumbnailUrl:n.media$group.media$thumbnail.filter(function(n){return n.yt$name==="default"})[0].url,comments:[],startTimeInMs:0,endTimeInMs:n.media$group.yt$duration.seconds*1e3}});kt(t)})}function kt(n){u.show(),n.forEach(function(n){$('<li class="search__results__item"><img class="search__results__item__thumbnail" src="'+n.thumbnailUrl+'" /><span class="search__results__item__title">'+n.title+"<\/span><\/li>").data("video",n).appendTo(u)})}function dt(){Handlebars.registerHelper("time_input",function(n){return y=y||Handlebars.compile($("#time-input-template").html()),new Handlebars.SafeString(y({timeInMs:n}))})}var p,u,w,b,k,e,d,g,r={title:"",videos:[]},t=defaultVideo,i,o,s,c,l,a,y;n.init=et,n.onYouTubeIframeAPIReady=ct,n.load=nt,a=null})(YouTubeMixer||(YouTubeMixer={}))